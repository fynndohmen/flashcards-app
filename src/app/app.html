<!-- src/app/app.html -->

<div class="app-root">
  <header class="app-header">
    <h1>Flashcards</h1>
    <span class="app-subtitle">Simple flashcards with difficulty levels 1–10</span>
  </header>

  <main class="app-main">
    <!-- ================================
         View: Deck overview
         ================================ -->
    <section *ngIf="!selectedDeck" class="deck-list-view">
      <h2>Decks</h2>

      <div class="deck-create">
        <h3>Create new deck</h3>
        <form (ngSubmit)="createDeck()" #deckForm="ngForm" class="deck-form">
          <label>
            Name
            <input
              type="text"
              name="deckName"
              required
              [(ngModel)]="newDeckName"
              placeholder="e.g. Spanish – Verbs"
            />
          </label>

          <label>
            Description (optional)
            <textarea
              name="deckDescription"
              rows="2"
              [(ngModel)]="newDeckDescription"
              placeholder="Short description of the deck"
            ></textarea>
          </label>

          <button type="submit" [disabled]="!deckForm.form.valid || !newDeckName.trim()">
            Create deck
          </button>
        </form>
      </div>

      <div class="deck-list">
        <h3>Existing decks</h3>

        <p *ngIf="decks.length === 0" class="hint">
          No decks yet. Create your first deck above.
        </p>

        <ul *ngIf="decks.length > 0">
          <li *ngFor="let deck of decks" class="deck-item">
            <button type="button" class="deck-select" (click)="selectDeck(deck)">
              <div class="deck-name">{{ deck.name }}</div>
              <div class="deck-meta">
                <span>{{ deck.cards.length }} card(s)</span>
                <span *ngIf="deck.description"> · {{ deck.description }}</span>
              </div>
            </button>
            <button
              type="button"
              class="deck-delete"
              (click)="deleteDeck(deck); $event.stopPropagation()"
            >
              Delete
            </button>
          </li>
        </ul>
      </div>
    </section>

    <!-- ================================
         View: Single deck (menu + subviews)
         ================================ -->
    <section *ngIf="selectedDeck as deck" class="deck-detail-view">
      <div class="deck-detail-header">
        <button type="button" class="back-button" (click)="backToDeckList()">
          ← Back to deck overview
        </button>
        <div class="deck-info">
          <h2>{{ deck.name }}</h2>
          <p class="deck-description" *ngIf="deck.description">
            {{ deck.description }}
          </p>
          <p class="deck-description" *ngIf="!deck.description">
            {{ deck.cards.length }} card(s) in this deck.
          </p>
        </div>
      </div>

      <!-- Mode selection for the deck -->
      <section
        *ngIf="deckViewMode === 'menu'"
        class="card-form-section"
      >
        <h3>What do you want to do?</h3>
        <p class="hint">
          Choose whether you want to edit cards or practice this deck.
        </p>

        <div class="deck-menu-actions">
          <button type="button" (click)="goToEditMode()">
            Edit cards
          </button>
          <button type="button" class="secondary" (click)="goToPracticeMode()">
            Practice deck
          </button>
        </div>
      </section>

      <!-- ============================
           Edit view
           ============================ -->
      <div *ngIf="deckViewMode === 'edit'" class="deck-layout">
        <!-- Left column: card form -->
        <div class="deck-column deck-column-left">
          <section class="card-form-section">
            <div class="deck-detail-header" style="margin-bottom: 0.75rem">
              <button
                type="button"
                class="secondary"
                (click)="backToDeckMenu()"
              >
                ← Back to deck menu
              </button>
            </div>

            <h3 *ngIf="!cardForm.editingCardId">Create new card</h3>
            <h3 *ngIf="cardForm.editingCardId">Edit card</h3>

            <form (ngSubmit)="saveCard()" #cardFormRef="ngForm" class="card-form">
              <div class="card-side-form">
                <h4>Front</h4>

                <label>
                  Text
                  <textarea
                    name="frontText"
                    rows="3"
                    [(ngModel)]="cardForm.frontText"
                    placeholder="Question, word, term ..."
                  ></textarea>
                </label>

                <label>
                  Image
                  <input
                    type="file"
                    accept="image/*"
                    (change)="onFrontImageSelected($event)"
                  />
                </label>

                <div class="image-preview" *ngIf="cardForm.frontImageDataUrl">
                  <img
                    [src]="cardForm.frontImageDataUrl"
                    alt="Front side image"
                  />
                  <button type="button" (click)="clearFrontImage()">
                    Remove image
                  </button>
                </div>
              </div>

              <div class="card-side-form">
                <h4>Back</h4>

                <label>
                  Text
                  <textarea
                    name="backText"
                    rows="3"
                    [(ngModel)]="cardForm.backText"
                    placeholder="Answer, translation, explanation ..."
                  ></textarea>
                </label>

                <label>
                  Image
                  <input
                    type="file"
                    accept="image/*"
                    (change)="onBackImageSelected($event)"
                  />
                </label>

                <div class="image-preview" *ngIf="cardForm.backImageDataUrl">
                  <img
                    [src]="cardForm.backImageDataUrl"
                    alt="Back side image"
                  />
                  <button type="button" (click)="clearBackImage()">
                    Remove image
                  </button>
                </div>
              </div>

              <div class="card-form-actions">
                <button type="submit">
                  {{ cardForm.editingCardId ? 'Save changes' : 'Add card' }}
                </button>
                <button
                  type="button"
                  class="secondary"
                  *ngIf="cardForm.editingCardId"
                  (click)="resetCardForm()"
                >
                  Cancel
                </button>
              </div>
            </form>
          </section>
        </div>

        <!-- Right column: card list -->
        <div class="deck-column deck-column-right">
          <section class="card-list-section">
            <h3>Cards in this deck</h3>

            <p *ngIf="deck.cards.length === 0" class="hint">
              No cards in this deck yet. Create your first card on the left.
            </p>

            <table *ngIf="deck.cards.length > 0" class="card-table">
              <thead>
                <tr>
                  <th>Front</th>
                  <th>Back</th>
                  <th>Difficulty</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let card of deck.cards">
                  <td>
                    <div class="card-cell">
                      <div class="card-text" *ngIf="card.front.text">
                        {{ card.front.text }}
                      </div>
                      <div class="card-image-thumb" *ngIf="card.front.imageDataUrl">
                        <img [src]="card.front.imageDataUrl" alt="Front side image" />
                      </div>
                    </div>
                  </td>
                  <td>
                    <div class="card-cell">
                      <div class="card-text" *ngIf="card.back.text">
                        {{ card.back.text }}
                      </div>
                      <div class="card-image-thumb" *ngIf="card.back.imageDataUrl">
                        <img [src]="card.back.imageDataUrl" alt="Back side image" />
                      </div>
                    </div>
                  </td>
                  <td class="difficulty-cell">
                    {{ card.difficulty }}
                  </td>
                  <td class="actions-cell">
                    <button type="button" (click)="startEditCard(card)">
                      Edit
                    </button>
                    <button type="button" class="danger" (click)="deleteCard(card)">
                      Delete
                    </button>
                  </td>
                </tr>
              </tbody>
            </table>
          </section>
        </div>
      </div>

      <!-- ============================
           Practice view
           ============================ -->
      <section *ngIf="deckViewMode === 'practice'" class="practice-section">
        <div class="deck-detail-header" style="margin-bottom: 0.75rem">
          <button
            type="button"
            class="secondary"
            (click)="backToDeckMenu()"
          >
            ← Back to deck menu
          </button>
        </div>

        <h3>Practice mode</h3>

        <p *ngIf="deck.cards.length === 0" class="hint">
          Create some cards first before starting a practice session.
        </p>

        <div *ngIf="deck.cards.length > 0">
          <div *ngIf="!isPracticeMode">
            <button type="button" (click)="startPractice()">
              Start practice ({{ deck.cards.length }} card(s))
            </button>
          </div>

          <div *ngIf="isPracticeMode" class="practice-active">
            <p class="practice-progress">
              Card {{ practiceIndex + 1 }} of {{ practiceCards.length }}
            </p>

            <div *ngIf="currentPracticeCard as card" class="practice-card">
              <h4>
                {{ showBackSide ? 'Back side' : 'Front side' }}
              </h4>

              <p class="practice-text">
                {{
                  showBackSide
                    ? (card.back.text || '(no text on the back side)')
                    : (card.front.text || '(no text on the front side)')
                }}
              </p>

              <div class="practice-image" *ngIf="!showBackSide && card.front.imageDataUrl">
                <img [src]="card.front.imageDataUrl" alt="Front side image" />
              </div>
              <div class="practice-image" *ngIf="showBackSide && card.back.imageDataUrl">
                <img [src]="card.back.imageDataUrl" alt="Back side image" />
              </div>

              <div class="practice-actions">
                <button type="button" (click)="flipCard()">
                  Flip card
                </button>
              </div>

              <div class="practice-rating" *ngIf="showBackSide">
                <p>How difficult was this card?</p>
                <div class="rating-buttons">
                  <button
                    type="button"
                    *ngFor="let level of [1,2,3,4,5,6,7,8,9,10]"
                    (click)="rateCurrentCard(level)"
                  >
                    {{ level }}
                  </button>
                </div>
              </div>
            </div>

            <button type="button" class="secondary" (click)="exitPracticeMode()">
              End practice
            </button>
          </div>

          <p *ngIf="!isPracticeMode && practiceFinished" class="practice-finished">
            Practice session finished!
          </p>
        </div>
      </section>
    </section>
  </main>
</div>
